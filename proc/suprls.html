<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="Fitting (least squares) a multidimensional cubic spline to arbitrarily located data">
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>suprls &ndash; splpak</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">splpak </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../sourcefile/splpak.f90.html">Source File</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
                   <li><a href="../lists/types.html">Derived Types</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../sourcefile/splpak.f90.html">Source File</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>suprls
      <small>Subroutine</small>
      
    </h1>
      <div class="row" id="info-bar">
    <div class="col-lg-12">
      <div class="well well-sm">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

          <li id="statements"><i class="fa fa-list-ol"></i>
            <a data-toggle="tooltip"
               data-placement="bottom" data-html="true"
               title="33.7% of total for procedures.">234 statements</a>
          </li>

            <li id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/splpak.F90"> Source File</a>
            </li>
        </ul>
        <ol class="breadcrumb in-well text-right">
              <li><a href='../sourcefile/splpak.f90.html'>splpak.F90</a></li>
              <li><a href='../module/splpak_module.html'>splpak_module</a></li>
          <li class="active">suprls</li>
        </ol>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="panel panel-primary">
      <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/suprls.html#src">suprls</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>private  subroutine suprls(me, i, rowi, n, bi, a, nn, soln, err, ier)  
</h2>
    

    <p>To determine the least squares solution of a
  large overdetermined linear system.</p>
<p>Given the <code>m</code> by <code>n</code> matrix <code>r</code> (<code>m &gt;= n</code>)
  and the <code>m</code>-vector <code>b</code>,
  this routine calculates the <code>n</code>-vector <code>x</code> such
  that the euclidean norm of the residue (<code>r*x-b</code>)
  is minimized.  the subroutine accepts rows of
  the matrix one by one so that the entire matrix
  need not be stored at one time.  this allows
  large problems to be solved without peripheral
  storage.  the length of the rows is limited by
  the amount of scratch storage which can be set
  aside for use by the routine.  there is no
  restriction on the number of rows.</p>
<h3>Usage</h3>
<p><a href="../proc/suprls.html">suprls</a> is called once for
  each row of the matrix.  A final call returns
  the solution vector and the euclidean norm
  of the residual. This following sequence would
  process the <code>m</code> by <code>n</code> matrix <code>r</code> and the right hand
  side <code>m</code>-vector <code>b</code></p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="w"></span>
<span class="w">    </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="w"></span>
<span class="w">      </span><span class="c">! here set rowi(j) to the (i,j) element of r</span>
<span class="w">    </span><span class="k">end do</span><span class="w"></span>
<span class="w">    </span><span class="c">! here set bi to the ith component of b.</span>
<span class="w">    </span><span class="k">call </span><span class="n">suprls</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">rowi</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">bi</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">soln</span><span class="p">,</span><span class="n">err</span><span class="p">,</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">end do</span>
<span class="k">  call </span><span class="n">suprls</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">rowi</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">bi</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">soln</span><span class="p">,</span><span class="n">err</span><span class="p">,</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<h3>Algorithm</h3>
<p>given the <code>m</code> by <code>n</code> matrix <code>r</code> (<code>m&gt;=n</code>) and the
  <code>m</code>-vector <code>b</code>, we wish to find an <code>n</code>-vector <code>x</code>
  such that</p>
<div class="codehilite"><pre><span></span><code>      e = l2-norm of  r*x-b
</code></pre></div>

<p>is minimized.  since the euclidean norm is
  invariant under orthogonal transformation,
  <code>r</code> and <code>b</code> may be premultiplied by any
  orthogonal matrix without changing the
  norm of the residual (<code>r*x-b</code>).  <code>r</code> is reduced
  to upper triangular form by premultiplying
  <code>r</code> and <code>b</code> by a sequence of householder and
  rotation matrices.  when the reduction is
  complete, the norm of the residual takes the
  form</p>
<div class="codehilite"><pre><span></span><code>    e =  l2 norm(t*x-b(n))+l2 norm(b(m-n))
</code></pre></div>

<p>where <code>t</code> is an <code>n</code> by <code>n</code> upper triangular
  matrix, <code>b(n)</code> is a vector of the first <code>n</code>
  components of <code>b</code>, <code>b(m-n)</code> is a vector of
  the remaining <code>(m-n)</code> components of <code>b</code>.  <code>e</code> is
  minimized by taking <code>x</code> to be the solution
  of the system  <code>t*x=b(n)</code>.  this triangular
  system is therefore solved to give the
  required least squares solution.  the norm
  of the residual is then the l2-norm of <code>b(m-n)</code>.</p>
<p>at each phase of the reduction, as many rows
  as space permits are entered into the scratch
  area.  householder transformations are then
  used to zero out subdiagonal elements.  space
  is saved by eliminating storage for the
  zero subdiagonal terms.  if there is room
  for only one new row, rotation rather than
  householder matrices are used for greater
  speed.  when all <code>m</code> rows have been entered,
  reduction is completed and the triangular
  system solved.</p>
<h3>Reference</h3>
<ul>
<li>Hanson, R.J., and Lawson, C.L., "Extensions and
  applications of the householder algorithm
  for solving linear least squares problems".
  Math. of comp. vol.23, pp. 787-812. (1969)</li>
</ul>
<h3>Accuracy</h3>
<p>This will depend upon the size and condition
  of the matrix.  Near machine accuracy may be
  expected for well conditioned systems of
  moderate size.  If ill conditioning is
  suspect, a version using pivoting may be
  necessary.</p>
<h3>History</h3>
<ul>
<li>Original FORTRAN 66 version written in May 1972 by
    A.K. Cline of NCAR'S Scientific Computing Division.</li>
</ul>

    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th>Type</th>
<th>Intent</th><th>Optional</th>        <th>Attributes</th>
        <th></th>
        <th>Name</th>
        <th></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-me~7"></span>
              class(<a href='../type/splpak_type.html'>splpak_type</a>),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>me</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-i"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>i</strong></td>
            <td>
                <p>the index of the row being entered.  (<code>i</code> is 1
for the first call, increases by 1 for each
call, and is <code>m</code> when the final row is
entered).  After the final row has been
entered, <a href="../proc/suprls.html">suprls</a> is called with <code>i = 0</code> to
complete the reduction and solution.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rowi"></span>
              real(kind=wp),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rowi</strong>(n)</td>
            <td>
                <p>a vector which on the <code>i</code>th call contains the <code>n</code>
components of the <code>i</code>th row of the matrix.  the
dimension of <code>rowi</code> in calling program must be
at least <code>n</code>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>n</strong></td>
            <td>
                <p>the length of the rows of the matrix (i.e.,
the number of columns). <code>n &lt;= m</code>, where <code>m</code> is
the number of rows.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bi"></span>
              real(kind=wp),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>bi</strong></td>
            <td>
                <p>on the <code>i</code>th call, <code>bi</code> contains the <code>i</code>th element
of the right hand side vector <code>b</code>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a"></span>
              real(kind=wp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>a</strong>(nn)</td>
            <td>
                <p>a working array which must not be changed
between the successive calls to <a href="../proc/suprls.html">suprls</a>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nn"></span>
              integer,
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>nn</strong></td>
            <td>
                <p>length of scratch array <code>a</code>. <code>nn</code> must be at
least <code>n*(n+5)/2+1</code>. For speed, <code>nn</code> should be
as large as possible up to a maximum of
<code>(n+1)*m</code>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-soln"></span>
              real(kind=wp),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>soln</strong>(n)</td>
            <td>
                <p>the <code>n</code>-components of the solution vector are
returned in this array after the final call
to <a href="../proc/suprls.html">suprls</a>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-err"></span>
              real(kind=wp),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>err</strong></td>
            <td>
                <p>the euclidean norm of the residual is
returned in <code>err</code> after the final call to
<a href="../proc/suprls.html">suprls</a>.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ier"></span>
              integer,
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>ier</strong></td>
            <td>
                <p>error parameter.
fatal errors:</p>
<ul>
<li>32 -- insufficient scratch storage provided,
   must have <code>nn &gt;= n*(n+5)/2+1</code>.</li>
<li>33 -- array has too few rows.  must have
   <code>m &gt;= n</code>.</li>
<li>34 -- system is singular.</li>
<li>35 -- values of <code>i</code> not in sequence.</li>
</ul>
            </td>
        </tr>
    </tbody>
  </table>

    <br>
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~suprls~~CallsGraph Pages: 1 -->
<svg id="procsuprlsCallsGraph" width="152pt" height="32pt"
 viewBox="0.00 0.00 152.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~suprls~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>proc~~suprls~~CallsGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 148,-28 148,4 -4,4"/>
<!-- proc~suprls -->
<g id="proc~~suprls~~CallsGraph_node1" class="node">
<title>proc~suprls</title>
<polygon fill="none" stroke="black" points="54,-24 0,-24 0,0 54,0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">suprls</text>
</g>
<!-- proc~cfaerr -->
<g id="proc~~suprls~~CallsGraph_node2" class="node">
<title>proc~cfaerr</title>
<g id="a_proc~~suprls~~CallsGraph_node2"><a xlink:href=".././proc/cfaerr.html" xlink:title="cfaerr">
<polygon fill="#d9534f" stroke="#d9534f" points="144,-24 90,-24 90,0 144,0 144,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cfaerr</text>
</a>
</g>
</g>
<!-- proc~suprls&#45;&gt;proc~cfaerr -->
<g id="proc~~suprls~~CallsGraph_edge1" class="edge">
<title>proc~suprls&#45;&gt;proc~cfaerr</title>
<path fill="none" stroke="#000000" d="M54.4,-12C62.39,-12 71.31,-12 79.82,-12"/>
<polygon fill="#000000" stroke="#000000" points="79.92,-15.5 89.92,-12 79.92,-8.5 79.92,-15.5"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="597pt" height="32pt"
 viewBox="0.00 0.00 596.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 592.5,-28 592.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="388.5,-24 243.5,-24 243.5,0 388.5,0 388.5,-24"/>
<text text-anchor="middle" x="316" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="465,-24 407,-24 407,0 465,0 465,-24"/>
<text text-anchor="middle" x="436" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="588.5,-24 483.5,-24 483.5,0 588.5,0 588.5,-24"/>
<text text-anchor="middle" x="536" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
    <br>

    <section class="visible-xs visible-sm hidden-md">
        <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="panel panel-primary">
      <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/suprls.html#src">suprls</a>
      </div>
    </div>


    </section>
    <br class="visible-xs visible-sm hidden-md">


    
    

    
    


    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">suprls</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">rowi</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">bi</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">soln</span><span class="p">,</span><span class="n">err</span><span class="p">,</span><span class="n">ier</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">class</span><span class="p">(</span><span class="n">splpak_type</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">me</span><span class="w"></span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="c">!! the index of the row being entered.  (`i` is 1</span>
<span class="w">                            </span><span class="c">!! for the first call, increases by 1 for each</span>
<span class="w">                            </span><span class="c">!! call, and is `m` when the final row is</span>
<span class="w">                            </span><span class="c">!! entered).  After the final row has been</span>
<span class="w">                            </span><span class="c">!! entered, [[suprls]] is called with `i = 0` to</span>
<span class="w">                            </span><span class="c">!! complete the reduction and solution.</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nn</span><span class="w"> </span><span class="c">!! length of scratch array `a`. `nn` must be at</span>
<span class="w">                             </span><span class="c">!! least `n*(n+5)/2+1`. For speed, `nn` should be</span>
<span class="w">                             </span><span class="c">!! as large as possible up to a maximum of</span>
<span class="w">                             </span><span class="c">!! `(n+1)*m`.</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="c">!! the length of the rows of the matrix (i.e.,</span>
<span class="w">                            </span><span class="c">!! the number of columns). `n &lt;= m`, where `m` is</span>
<span class="w">                            </span><span class="c">!! the number of rows.</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rowi</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="c">!! a vector which on the `i`th call contains the `n`</span>
<span class="w">                                   </span><span class="c">!! components of the `i`th row of the matrix.  the</span>
<span class="w">                                   </span><span class="c">!! dimension of `rowi` in calling program must be</span>
<span class="w">                                   </span><span class="c">!! at least `n`.</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">bi</span><span class="w"> </span><span class="c">!! on the `i`th call, `bi` contains the `i`th element</span>
<span class="w">                              </span><span class="c">!! of the right hand side vector `b`.</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="w"> </span><span class="c">!! a working array which must not be changed</span>
<span class="w">                                    </span><span class="c">!! between the successive calls to [[suprls]].</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">soln</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="c">!! the `n`-components of the solution vector are</span>
<span class="w">                                    </span><span class="c">!! returned in this array after the final call</span>
<span class="w">                                    </span><span class="c">!! to [[suprls]].</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="c">!! the euclidean norm of the residual is</span>
<span class="w">                                </span><span class="c">!! returned in `err` after the final call to</span>
<span class="w">                                </span><span class="c">!! [[suprls]].</span>
<span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ier</span><span class="w"> </span><span class="c">!! error parameter.</span>
<span class="w">                               </span><span class="c">!! fatal errors:</span>
<span class="w">                               </span><span class="c">!!</span>
<span class="w">                               </span><span class="c">!!  * 32 -- insufficient scratch storage provided,</span>
<span class="w">                               </span><span class="c">!!    must have `nn &gt;= n*(n+5)/2+1`.</span>
<span class="w">                               </span><span class="c">!!  * 33 -- array has too few rows.  must have</span>
<span class="w">                               </span><span class="c">!!    `m &gt;= n`.</span>
<span class="w">                               </span><span class="c">!!  * 34 -- system is singular.</span>
<span class="w">                               </span><span class="c">!!  * 35 -- values of `i` not in sequence.</span>

<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">cn</span><span class="p">,</span><span class="n">sn</span><span class="w"></span>
<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="n">ilj</span><span class="p">,</span><span class="n">ilnp</span><span class="p">,</span><span class="n">nreq</span><span class="p">,</span><span class="n">k</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">               </span><span class="n">idiag</span><span class="p">,</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jp1</span><span class="p">,</span><span class="n">lmkm1</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">jdel</span><span class="p">,</span><span class="n">idj</span><span class="p">,</span><span class="n">iijd</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">               </span><span class="n">i1jd</span><span class="p">,</span><span class="n">k11</span><span class="p">,</span><span class="n">k1m1</span><span class="p">,</span><span class="n">i11</span><span class="p">,</span><span class="n">np1mk</span><span class="p">,</span><span class="n">lmk</span><span class="p">,</span><span class="n">imov</span><span class="p">,</span><span class="n">iii</span><span class="p">,</span><span class="n">iiim</span><span class="p">,</span><span class="n">iim1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">               </span><span class="n">ilk</span><span class="p">,</span><span class="n">npk</span><span class="p">,</span><span class="n">ilii</span><span class="p">,</span><span class="n">npii</span><span class="w"></span>
<span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">complete_reduction</span><span class="w"> </span><span class="c">!! Routine entered with `I&lt;=0` means complete</span>
<span class="w">                                  </span><span class="c">!! the reduction and store the solution in `SOLN`.</span>

<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0e-18_wp</span><span class="w"> </span><span class="c">!! small number tolerance</span>

<span class="w">    </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">complete_reduction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">complete_reduction</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>

<span class="w">            </span><span class="c">!  Set up quantities on first call.</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">iold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">            </span><span class="c">!  Compute how many rows can be input now.</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nn</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">il1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">k1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">errsum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">            </span><span class="n">nreq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>

<span class="w">            </span><span class="c">!  Error exit if insufficient scratch storage provided.</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nn</span><span class="o">&lt;</span><span class="n">nreq</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="w"></span>
<span class="w">                </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;nn   = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nn</span><span class="w"></span>
<span class="w">                </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;nreq = &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nreq</span><span class="w"></span>
<span class="w">                </span><span class="k">call </span><span class="n">cfaerr</span><span class="p">(</span><span class="n">ier</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">                            </span><span class="s1">&#39; suprls - insufficient scratch storage provided. &#39;</span><span class="o">//</span><span class="p">&amp;</span><span class="w"></span>
<span class="w">                            </span><span class="s1">&#39;at least ((N+5)*N+2)/2 locations needed&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span>
<span class="k">            end if</span>

<span class="k">        end if</span><span class="w"></span>

<span class="w">        </span><span class="c">!  Error exit if (I-IOLD)/=1.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">me</span><span class="p">%</span><span class="n">iold</span><span class="p">)</span><span class="o">/=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">35</span><span class="w"></span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;i    =&#39;</span><span class="p">,</span><span class="n">i</span><span class="w"></span>
<span class="w">            </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;me%iold =&#39;</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">iold</span><span class="w"></span>
<span class="w">            </span><span class="k">call </span><span class="n">cfaerr</span><span class="p">(</span><span class="n">ier</span><span class="p">,</span><span class="s1">&#39; suprls - values of I not in sequence&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span>
<span class="k">        end if</span><span class="w"></span>

<span class="w">        </span><span class="c">!  Store the row in the scratch storage.</span>
<span class="w">        </span><span class="n">me</span><span class="p">%</span><span class="n">iold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"></span>
<span class="w">        </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="w"></span>
<span class="w">            </span><span class="n">ilj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">            </span><span class="n">a</span><span class="p">(</span><span class="n">ilj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowi</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">end do</span>
<span class="k">        </span><span class="n">ilnp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">        </span><span class="n">a</span><span class="p">(</span><span class="n">ilnp</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bi</span><span class="w"></span>
<span class="w">        </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">        </span><span class="n">me</span><span class="p">%</span><span class="n">isav</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="k">return</span>

<span class="k">    end if</span>

<span class="k">    </span><span class="n">main</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">do</span>

<span class="k">        if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">complete_reduction</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">me</span><span class="p">%</span><span class="n">k1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">idiag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="o">-</span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">                    </span><span class="c">!  Apply rotations to zero out the single new row.</span>
<span class="w">                    </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">k1</span><span class="w"></span>
<span class="w">                        </span><span class="n">idiag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idiag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">il1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">tol</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">))</span><span class="w"></span>
<span class="w">                        </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">))</span><span class="o">&lt;</span><span class="n">tol</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">))</span><span class="w"></span>
<span class="w">                        </span><span class="k">else</span>
<span class="k">                            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="o">+</span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">))</span><span class="w"></span>
<span class="w">                        </span><span class="k">end if</span>
<span class="k">                        if</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<span class="k">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"></span>
<span class="w">                        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0_wp</span><span class="o">/</span><span class="n">s</span><span class="w"></span>
<span class="w">                        </span><span class="n">cn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">s</span><span class="w"></span>
<span class="w">                        </span><span class="n">sn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="w"></span>
<span class="w">                        </span><span class="n">jp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="k">do </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jp1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                            </span><span class="n">jdel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">                            </span><span class="n">idj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idiag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jdel</span><span class="w"></span>
<span class="w">                            </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">idj</span><span class="p">)</span><span class="w"></span>
<span class="w">                            </span><span class="n">i1jd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jdel</span><span class="w"></span>
<span class="w">                            </span><span class="n">a</span><span class="p">(</span><span class="n">idj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cn</span><span class="o">*</span><span class="n">temp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sn</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">i1jd</span><span class="p">)</span><span class="w"></span>
<span class="w">                            </span><span class="n">a</span><span class="p">(</span><span class="n">i1jd</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sn</span><span class="o">*</span><span class="n">temp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cn</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">i1jd</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">end do</span>
<span class="k">                    end do</span>
<span class="k">                else</span><span class="w"></span>
<span class="w">                    </span><span class="c">!  Apply householder transformations to zero out new rows.</span>
<span class="w">                    </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">k1</span><span class="w"></span>
<span class="w">                        </span><span class="n">idiag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idiag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">il1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">                        </span><span class="n">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="o">-</span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">end do</span>
<span class="k">                        if</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<span class="k">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="o">&gt;</span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0_wp</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">idiag</span><span class="p">))</span><span class="w"></span>
<span class="w">                        </span><span class="n">jp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="k">do </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jp1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                            </span><span class="n">jdel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">                            </span><span class="n">idj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idiag</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jdel</span><span class="w"></span>
<span class="w">                            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">idj</span><span class="p">)</span><span class="w"></span>
<span class="w">                            </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                                </span><span class="n">iijd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jdel</span><span class="w"></span>
<span class="w">                                </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">iijd</span><span class="p">)</span><span class="w"></span>
<span class="w">                            </span><span class="k">end do</span>
<span class="k">                            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">temp1</span><span class="w"></span>
<span class="w">                            </span><span class="n">a</span><span class="p">(</span><span class="n">idj</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">idj</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">temp</span><span class="w"></span>
<span class="w">                            </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                                </span><span class="n">iijd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jdel</span><span class="w"></span>
<span class="w">                                </span><span class="n">a</span><span class="p">(</span><span class="n">iijd</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">iijd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="w"></span>
<span class="w">                            </span><span class="k">end do</span>
<span class="k">                        end do</span>
<span class="k">                    end do</span>
<span class="k">                end if</span>

<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="o">&gt;=</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">lmkm1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="w"></span>

<span class="w">                    </span><span class="c">!  Accumulate residual sum of squares.</span>
<span class="w">                    </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">lmkm1</span><span class="w"></span>
<span class="w">                        </span><span class="n">ilnp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">il1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ii</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                        </span><span class="n">me</span><span class="p">%</span><span class="n">errsum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">errsum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">ilnp</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">ilnp</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">exit </span><span class="n">main</span><span class="w"></span>
<span class="w">                    </span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="w"></span>
<span class="w">                    </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">il1</span><span class="w"></span>

<span class="w">                    </span><span class="c">!  Determine how many new rows may be input on next iteration.</span>
<span class="w">                    </span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">nn</span><span class="o">-</span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="p">)</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                    </span><span class="k">return</span>
<span class="k">                end if</span>
<span class="k">            end if</span>

<span class="k">            </span><span class="n">k11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">k1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">k1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="o">-</span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="o">/=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">k1m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">k1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="o">&gt;</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="n">k1m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">                </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">il1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k11</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">                </span><span class="c">!  Perform householder transformations to reduce rows to upper</span>
<span class="w">                </span><span class="c">!  triangular form.</span>
<span class="w">                </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k11</span><span class="p">,</span><span class="n">k1m1</span><span class="w"></span>
<span class="w">                    </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="n">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                    </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"></span>
<span class="w">                    </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    if</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<span class="k">                    </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="o">&gt;</span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0_wp</span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">i1</span><span class="p">))</span><span class="w"></span>
<span class="w">                    </span><span class="n">jp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                    </span><span class="n">i11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                    </span><span class="k">do </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jp1</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                        </span><span class="n">jdel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">                        </span><span class="n">i1jd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jdel</span><span class="w"></span>
<span class="w">                        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">i1jd</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i11</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                            </span><span class="n">iijd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jdel</span><span class="w"></span>
<span class="w">                            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">iijd</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">end do</span>
<span class="k">                        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">temp1</span><span class="w"></span>
<span class="w">                        </span><span class="n">i1jd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jdel</span><span class="w"></span>
<span class="w">                        </span><span class="n">a</span><span class="p">(</span><span class="n">i1jd</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">i1jd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">temp</span><span class="w"></span>
<span class="w">                        </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i11</span><span class="p">,</span><span class="n">i2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                            </span><span class="n">iijd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">jdel</span><span class="w"></span>
<span class="w">                            </span><span class="n">a</span><span class="p">(</span><span class="n">iijd</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">iijd</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">end do</span>
<span class="k">                    end do</span>
<span class="k">                end do</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="o">&gt;</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">np1mk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="w"></span>
<span class="w">                    </span><span class="n">lmk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="w"></span>
<span class="w">                    </span><span class="c">! Accumulate residual sum of squares.</span>
<span class="w">                    </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np1mk</span><span class="p">,</span><span class="n">lmk</span><span class="w"></span>
<span class="w">                        </span><span class="n">ilnp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">il1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ii</span><span class="o">*</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">                        </span><span class="n">me</span><span class="p">%</span><span class="n">errsum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">errsum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">ilnp</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">(</span><span class="n">ilnp</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                end if</span>
<span class="k">            end if</span>
<span class="k">            </span><span class="n">imov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">il1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k11</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">            </span><span class="c">!  Squeeze the unnecessary elements out of scratch storage to</span>
<span class="w">            </span><span class="c">!  allow space for more rows.</span>
<span class="w">            </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k11</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">k1</span><span class="w"></span>
<span class="w">                </span><span class="n">imov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imov</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                </span><span class="n">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ii</span><span class="w"></span>
<span class="w">                </span><span class="k">do </span><span class="n">iii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="w"></span>
<span class="w">                    </span><span class="n">iiim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iii</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">imov</span><span class="w"></span>
<span class="w">                    </span><span class="n">a</span><span class="p">(</span><span class="n">iiim</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">iii</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">            end do</span>
<span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">imov</span><span class="w"></span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">il1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">exit </span><span class="n">main</span><span class="w"></span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="w"></span>

<span class="w">            </span><span class="c">!  Determine how many new rows may be input on next iteration.</span>
<span class="w">            </span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">nn</span><span class="o">-</span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="p">)</span><span class="o">/</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span>

<span class="k">        end if</span><span class="w"></span>

<span class="w">        </span><span class="c">! Complete reduction and store solution in SOLN.</span>
<span class="w">        </span><span class="n">complete_reduction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"> </span><span class="c">! reset this flag</span>
<span class="w">        </span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">isav</span><span class="w"></span>

<span class="w">        </span><span class="c">! Error exit if L less than N.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">l</span><span class="o">&lt;</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">33</span><span class="w"></span>
<span class="w">            </span><span class="k">call </span><span class="n">cfaerr</span><span class="p">(</span><span class="n">ier</span><span class="p">,</span><span class="s1">&#39; suprls - array has too few rows.&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span>
<span class="k">        end if</span><span class="w"></span>

<span class="w">        </span><span class="c">! K/=ISAV means further reduction needed.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="o">==</span><span class="n">me</span><span class="p">%</span><span class="n">isav</span><span class="p">)</span><span class="w"> </span><span class="k">exit </span><span class="n">main</span><span class="w"></span>

<span class="w">    </span><span class="k">end do </span><span class="n">main</span><span class="w"></span>

<span class="w">    </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">        </span><span class="c">! Error return if system is singular.</span>
<span class="w">        </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">34</span><span class="w"></span>
<span class="w">        </span><span class="k">call </span><span class="n">cfaerr</span><span class="p">(</span><span class="n">ier</span><span class="p">,</span><span class="s1">&#39; suprls - system is singular.&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span>
<span class="k">    end if</span><span class="w"></span>

<span class="w">    </span><span class="c">! Solve triangular system into ROWI.</span>
<span class="w">    </span><span class="n">soln</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="p">)</span><span class="o">/</span><span class="n">a</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">do </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="w"></span>
<span class="w">        </span><span class="n">iim1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ii</span><span class="w"></span>
<span class="w">        </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">iim1</span><span class="w"></span>
<span class="w">            </span><span class="n">ilk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"></span>
<span class="w">            </span><span class="n">npk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"></span>
<span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">ilk</span><span class="p">)</span><span class="o">*</span><span class="n">soln</span><span class="p">(</span><span class="n">npk</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">end do</span>
<span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="c">! JW : is this necessary ???</span>
<span class="w">        </span><span class="n">ilii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ii</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">ilii</span><span class="p">)</span><span class="o">==</span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">            </span><span class="c">! Error return if system is singular.</span>
<span class="w">            </span><span class="n">ier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">34</span><span class="w"></span>
<span class="w">            </span><span class="k">call </span><span class="n">cfaerr</span><span class="p">(</span><span class="n">ier</span><span class="p">,</span><span class="s1">&#39; suprls - system is singular.&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span>
<span class="k">        end if</span>
<span class="k">        </span><span class="n">npii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">np1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ii</span><span class="w"></span>
<span class="w">        </span><span class="n">soln</span><span class="p">(</span><span class="n">npii</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="o">/</span><span class="n">a</span><span class="p">(</span><span class="n">ilii</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">end do</span><span class="w"></span>

<span class="w">    </span><span class="c">! Store residual norm.</span>
<span class="w">    </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">errsum</span><span class="p">)</span><span class="w"></span>

<span class="k">end subroutine </span><span class="n">suprls</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>splpak was developed by Jacob Williams<br>&copy; 2023 
</p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
          </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>